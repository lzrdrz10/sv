<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estrenos 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style> body { font-family: "Poppins", sans-serif; }
  /* ======= AJUSTA ESTE VALOR ======= */
:root {
  --preloader-time: 3s;  /* Cambia aquí el tiempo total (ejemplo: 3s, 5s, 10s) */
}

/* Preloader cubre toda la pantalla */
#preloader {
  position: fixed;
  inset: 0;
  background: #141414;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  transition: opacity 0.8s ease;
}

/* Al ocultarse */
#preloader.hide {
  opacity: 0;
  pointer-events: none;
}

/* Contenido */
.preloader-content {
  text-align: center;
  color: #65615F;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

/* Imagen */
.preloader-content img {
  width: 220px;
  max-width: 80vw;
  filter: drop-shadow(0px -2px 9px #303030);
}

/* Barra de progreso */
.prog-bar-wrapper {
  width: 205px;
  height: 6px;
  position: relative;
  border-radius: 50px;
  overflow: hidden;
}
.prog-bar-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #919191;
  border-radius: 50px;
}
.prog-bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 0;
  height: 100%;
  background: linear-gradient(to right,#e300ff,#007cf0);
  border-radius: 50px;
  animation: loadbar var(--preloader-time) forwards;
}
@keyframes loadbar {
  to { width: 100%; }
}

/* Texto + spinner */
.preloader-extra {
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: center;
  font-size: 12px;
  gap: 8px;
}

/* Spinner */
.spinner div {
  width: 20px;
  height: 20px;
  border: 4px solid #65615F;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}</style>
</head>
<body class="bg-[#04143B] text-white min-h-screen">
	<div id="preloader">
  <div class="preloader-content">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3dK3-XAKrEia-lWmiUqAYRfFQ1lR9eJX6ZZH8e_vHf576qf9GJjIWBW9Jg5LsilXX7WO2MOEkg5gzc4pESziaPeMJ9ws9mwtCDdp3p_17D0e0Uop_ZxavwwJeNLBvoyZJ0cxTKQpjzrJIR6LjJslB24tj-77AYrRCacQ3F2S2VPoXpPzPhM1zndxyd1Rg/s3307/B64D5386-DCA4-410B-A0A6-6ACB19D0A06F.png" alt="Logo Preloader" />
    
    <div class="prog-bar-wrapper">
      <div class="prog-bar-bg"></div>
      <div class="prog-bar"></div>
    </div>
    
    <div class="preloader-extra">
      <div class="spinner"><div></div></div>
      <p>Espere, cargando nuestro contenido</p>
    </div>
  </div>
</div>
  <!-- Header -->
  <header class="fixed top-0 left-0 w-full z-50 bg-[#04143B] flex flex-col md:flex-row items-center justify-between px-4 py-3 max-w-[1280px] mx-auto">
    <div class="flex items-center space-x-4 w-full md:w-auto justify-between">
      <div class="flex flex-row items-center space-x-3 mb-6">
        <button onclick="history.back()" class="bg-[#0D1B4C] rounded-full px-4 py-1.5 text-sm font-semibold text-[#4A7FFF] flex items-center space-x-1">
          <i class="fas fa-arrow-left"></i><span>Atras</span>
        </button>
        <h1 class="text-2xl font-extrabold text-[#4A7FFF] select-none">Estrenos 2025</h1>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-[1280px] mx-auto px-4 mt-24">
    <section id="content-section" class="grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
      <!-- Contenido cargado dinámicamente -->
    </section>

    <!-- Paginación -->
    <div class="flex justify-center items-center gap-4 mt-6 mb-10">
      <button id="prevPage" class="bg-[#0D1B4C] text-white px-4 py-2 rounded hover:bg-[#1A2A6C] disabled:opacity-50" disabled>Atrás</button>
      <button id="nextPage" class="bg-[#0D1B4C] text-white px-4 py-2 rounded hover:bg-[#1A2A6C]" disabled>Siguiente</button>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
  const preloader = document.getElementById("preloader");
  const duration = getComputedStyle(document.documentElement)
                    .getPropertyValue("--preloader-time")
                    .trim();

  // Convierte el valor de CSS (ej: "4s") a milisegundos
  const ms = parseFloat(duration) * (duration.includes("ms") ? 1 : 1000);

  setTimeout(() => {
    preloader.classList.add("hide");
  }, ms);
});
    
    const GITHUB_API = "https://api.github.com/repos/lzrdrz10/sv/contents/";
    const GITHUB_RAW = "https://raw.githubusercontent.com/lzrdrz10/sv/main/";
    const LOCAL_JSON_KEY = "estrenos2025";
    const ITEMS_PER_PAGE = 15; // Cantidad de estrenos por página

    let estrenos = [];
    let currentPage = 1;

    async function fetchFileContentRaw(filePath) {
      try {
        const res = await fetch(GITHUB_RAW + filePath);
        if (!res.ok) return null;
        const html = await res.text();
        const parser = new DOMParser();
        return parser.parseFromString(html, "text/html");
      } catch (e) { console.error("Error fetching file:", filePath, e); return null; }
    }

    async function fetchFileList(folder) {
      try {
        const res = await fetch(GITHUB_API + folder);
        if (!res.ok) throw new Error(`Failed to fetch ${folder} contents`);
        const files = await res.json();
        return files.filter(file => file.name.endsWith(".html")).map(file => `${folder}/${file.name}`);
      } catch (e) { console.error(`Error fetching file list for ${folder}:`, e); return []; }
    }

    async function buscarEstrenos() {
      estrenos = JSON.parse(localStorage.getItem(LOCAL_JSON_KEY) || "[]");

      const folder = "Peliculas";
      const files = await fetchFileList(folder);
      const archivosNuevos = files.filter(f => !estrenos.some(e => e.url === f));

      if (archivosNuevos.length > 0) {
        const docs = await Promise.all(archivosNuevos.map(f => fetchFileContentRaw(f)));
        docs.forEach((doc, i) => {
          if (!doc) return;
          const spans = [...doc.querySelectorAll("span")];
          const año = spans.find(s => /\d{4}/.test(s.textContent))?.textContent || "";
          if (spans.some(s => s.textContent.includes("2025") || s.textContent.includes("Año: 2025"))) {
            const titulo = doc.querySelector("h1,h2,h3")?.textContent.trim() || archivosNuevos[i].split("/").pop();
            const poster = doc.querySelector("img")?.src || "https://via.placeholder.com/300x450?text=No+Image";
            estrenos.push({ tipo: "Movie", titulo, url: archivosNuevos[i], año, poster });
          }
        });
        localStorage.setItem(LOCAL_JSON_KEY, JSON.stringify(estrenos));
      }

      renderPage(currentPage);
      actualizarBotones();
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function renderPage(page) {
      const contenedor = document.getElementById("content-section");
      contenedor.innerHTML = "";
      if (estrenos.length === 0) {
        contenedor.innerHTML = `<div class="col-span-full text-center text-white/70 py-8"><p>No se encontraron estrenos para 2025.</p></div>`;
        return;
      }

      const aleatorios = shuffleArray([...estrenos]);
      const startIndex = (page - 1) * ITEMS_PER_PAGE;
      const pageItems = aleatorios.slice(startIndex, startIndex + ITEMS_PER_PAGE);

      pageItems.forEach(e => {
        const article = document.createElement("article");
        article.className = "relative rounded-lg overflow-hidden cursor-pointer select-none";
        article.innerHTML = `
          <a href="../../${e.url}">
            <img src="${e.poster}" alt="${e.titulo}" loading="lazy"
                 class="w-full h-auto rounded-lg object-cover transition-transform duration-300 hover:scale-105"/>
            <div class="absolute top-2 right-2 bg-white/90 text-black text-xs font-semibold rounded-full px-2 py-0.5">
              ${e.tipo}
            </div>
          </a>
          <div class="mt-2 font-semibold text-sm leading-tight truncate">${e.titulo}</div>
          <div class="text-xs text-white/70">${e.año}</div>
        `;
        contenedor.appendChild(article);
      });

      actualizarBotones();
    }

    function actualizarBotones() {
      const totalPages = Math.ceil(estrenos.length / ITEMS_PER_PAGE);
      document.getElementById("prevPage").disabled = currentPage === 1;
      document.getElementById("nextPage").disabled = currentPage >= totalPages;
    }

    document.getElementById("prevPage").addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderPage(currentPage);
      }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
      const totalPages = Math.ceil(estrenos.length / ITEMS_PER_PAGE);
      if (currentPage < totalPages) {
        currentPage++;
        renderPage(currentPage);
      }
    });

    buscarEstrenos();
  </script>

</body>
</html>
